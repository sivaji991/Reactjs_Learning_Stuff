<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <style>
      body{
        font-family: Arial;
        margin-top: 0px;
        margin-bottom: 0px;
      }
      .send-button{
        background-color: #198754;
        color: white;
        padding: 12px 20px;
        margin-left: 10px;
        border: none;
        border-radius: 10px;
        font-size: 15px;
        cursor: pointer;
      }
      .chat-input{
        padding: 12px 15px;
        border-radius: 10px;
        border-width: 1px;
        font-size: 15px;
        flex-grow: 1;
      }
      .chat-input-container{
        display: flex;
        margin-bottom: 60px;
      }
      .app-container{
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;

        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .chat-message-user{
        display: flex;
        justify-content: end;
        align-items: start;
      }
      .chat-message-robot{
        display: flex;  
        align-items: start;
      }
      .chat-message-text{
        background-color: #eeeeee;
        padding: 15px 20px;
        border-radius: 10px;
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 20px;
        max-width: 300px;
      }
      .chat-message-profile{
        width: 45px;
      }
      .chat-messages-container{
        flex-grow: 1;
        margin-top: 20px;
        overflow: scroll;
        scrollbar-width: none;
      }
      .welcome-container{
        color: rgb(120,120,120);
        text-align: center;
      }
      .spinner{
        height: 40px;
        margin: -15px;
      }
    </style>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script type="text/babel">
      function ChatInput( { chatMessages,setChatMessages } ){
        const [inputText, setInputText ] = React.useState('');
        const [isLoading,setIsLoading] = React.useState(false);
        function saveInputText(event){
          setInputText(event.target.value);
        }
        async function  sendMessage(){  
          if(isLoading || inputText ===''){
            return;
            
          }

          // Set isLoading to true at the start, and set it to
          // false after everything is done.
          setIsLoading(true);

          // We can put this at the top of the function or
          // after the first setChatMessages(). Both work.
          setInputText('');


          //Here we have done "Lifting the State UP" means , Share state between multiple components , to access the "setChatMessages" in this 'ChatInput' component from the 'ChatMessages' component
          const newChatMessages = [
            ...chatMessages,
            {
              message:inputText,
              sender:'user',
              id: crypto.randomUUID()
            }
          ]
          setChatMessages(newChatMessages);

                setChatMessages([
                  ...newChatMessages,
                  // This creates a temporary Loading... message.
                  // Because we don't save this message in newChatMessages,
                  // it will be remove later, when we add the response.
                  {
                    message: <img className='spinner' src="/new/loading-spinner.gif"/>,
                    sender: 'robot',
                    id: crypto.randomUUID()
                  }
                ]);

          const response = await Chatbot.getResponseAsync(inputText);
          setChatMessages([
            ...newChatMessages,
            {
              message:response,
              sender:'robot',
              id: crypto.randomUUID()
            }
          ]);

          setIsLoading(false);
          
          // setInputText('')
        }
        //State does not update immediately , 
        //State is updated after all of the code is finished

        //Using the 'value' property we controlle the Input like in the following

        function enterKeyFunc(event){
          if(event.key === 'Enter'){
            // console.log('entered');
            sendMessage();
          }else if(event.key === 'Escape'){
            setInputText('')
          }
        }
        return(
          <div className = 'chat-input-container'>
            <input
              className = 'chat-input'
              placeholder="Send a message to chatbot" size="30"
              onChange={saveInputText}
              onKeyDown={enterKeyFunc}
              value = {inputText}
            />
            <button
              className = 'send-button'
              onClick={sendMessage}
            >Send</button>
          </div>
        )
      }
      function ChatMessage({ message,sender }){
        // const message = props.message;
        // const sender = props.sender;
        // const { message, sender } = props;

        /*  if (sender === 'robot') {
          return (
            <div>
              <img src="/new/robot.png" alt="user" width="45"/>
              {message}
            </div>
          );
        }   */

        return(
          <div className={
            sender ==='user'
              ? 'chat-message-user' 
              : 'chat-message-robot'
          }>
            {
              sender === 'robot' && (
              <img src="/new/robot.png" 
              className = 'chat-message-profile'
              />
            )}
            <div className='chat-message-text'>
              {message}
              </div>
            {
              sender === 'user' && (
              <img src="/new/user.png" 
              className = 'chat-message-profile'
              />
            )}
          </div>
        )
      }

      /* function ChatMessages( { chatMessages } ){

        const chatMessagesRef = React.useRef(null);
        
        
      //10-01-2026
        // To use a function as a hook, the function name must
        // start with "use".
        function useAutoScroll(dependencies){
          // It's highly recommend to rename this to something
        // more generic like containerRef. This will make the
        // code make more sense if we ever reuse this code in
        // other components.

        const containerRef = React.useRef(null);
        React.useEffect(()=>{
          const containerElem = chatMessagesRef.current
          if(containerElem){
            containerElem.scrollTop = containerElem.scrollHeight
          }
        }, [chatMessages]);
        // React will run this function -
        //     -after component is created
        //     -every time th component is updated
            
          }, dependencies);

          return containerRef;
        }
      

       
      return(
        <div className = 'chat-messages-container'
            ref = {chatMessagesRef}>
          {chatMessages.map((chatMess)=>{
            return(
              <ChatMessage 
                message = {chatMess.message}
                sender = {chatMess.sender}
                key = {chatMess.id}
              />
            )
          })}
        </div>
      );
      }

        */

      // function ChatMessages({ chatMessages }) {
      //   const chatMessagesRef = React.useRef(null);
      // To use a function as a hook, the function name must
      // start with "use".
      function useAutoScroll(dependencies) {
        // It's highly recommend to rename this to something
        // more generic like containerRef. This will make the
        // code make more sense if we ever reuse this code in
        // other components.
        const containerRef = React.useRef(null);

        React.useEffect(() => {
          // const containerElem = chatMessagesRef.current;
          const containerElem = containerRef.current;
          if (containerElem) {
            containerElem.scrollTop = containerElem.scrollHeight;
          }
        // }, [chatMessages]);
        }, dependencies);

        return containerRef;
      }

      function ChatMessages({ chatMessages }) {
        const chatMessagesRef = useAutoScroll([chatMessages]);

        return (
          <div className="chat-messages-container" ref={chatMessagesRef}>
            {chatMessages.map((chatMessage) => {
              return (
                <ChatMessage
                  message={chatMessage.message}
                  sender={chatMessage.sender}
                  key={chatMessage.id}
                />
              );
            })}
          </div>
        );
      }


      function App(){

        const [chatMessages, setChatMessages] = React.useState([]);

        // const [chatMessages, setChatMessages] = React.useState([{
        //   message:'hello chatbot',
        //   sender:'user',
        //   id:'1'
        // },
        // {
        //   message:'Hello! How can I help you?',
        //   sender:'robot',
        //   id:'2'
        // },
        // {
        //   message:'todays date',
        //   sender:'user',
        //   id:'3'
        // },
        // {
        //   message:'Today is December 27',
        //   sender:'robot',
        //   id:'4'
        // }]);



        //const chatMessages = array[0];    //The current data
        //const setChatMessages = array[1];   //The Updater function

        //const [chatMessages, setChatMessages] =array;   //Array Destructuring

        

        /*State = data that is connected to the HTML,
          When we update this data, it will update the HTML.
        */


        return(
          <div className='app-container'>
            {chatMessages.length ===0 && (
              <p className='welcome-container'>Welcome to the Chatbot Project! Send a message using the textbox below.</p>
            )}
            <ChatMessages 
              chatMessages = {chatMessages}
            />
            <ChatInput 
              chatMessages = {chatMessages}
              setChatMessages = {setChatMessages}
            />
        </div>
        )
      }

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);

    /*in the 2nd lesson :
      1. Save the data(using arrays and objects)
      2. Generatte the HTML(using .map() and key prop)
      3. Make it interactive, using onClick and onChange
      4. State = data that changes over time, and is connected to the HTML 
      5. Updater function = update the state and update the HTML 
      6. Array DDesstructuring
      7. Lifting the State Up = share state between components
      8. Made <ChatInput> interactive
      9. Got responses from the chatbot
      

    

    In the 3rd Lesson:
    1.CSS with React
    2.Styled the Chatbot Project
    3.Flexbox = create a flexicble layout
    4.Ternary Operator (?:) = if-else statement directly in the JSX
    5.hooks = insert React features into a component
    6. useEffect = run code after component is created or updated
    7. useRef = save an HTML element from the component
    8. Created auto-scroll feature 
    
    */

    </script>
  </body>
</html>